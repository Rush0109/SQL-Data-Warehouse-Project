/*
=============================================================================
Quality Checks
=============================================================================
Script Purpose : 
	This script performs various quality checks for data consistency, accuracy, 
	and standardization across the 'Silver' schema. It includes checks for: 
	- Null or duplicate primary key 
	- unwanted spaces in string fields 
	- Data standardization and consistency
	- Invalid date ranges and orders
	- Data consistency between related fields 
Usage Notes : 
	- Run these checks after data loading Silver layer 
	- Investigate and resolve any discrepancies found during the checks
=============================================================================
*/

PRINT '=========================================================='
PRINT 'Checking Silver.crm_cust_info'
PRINT '=========================================================='

--Check for null or Duplicates in Primary key
--Expectation : NO result
SELECT 
	cst_id,
	COUNT(*)
FROM Silver.crm_cust_info
GROUP BY cst_id
HAVING COUNT(*) > 1 
	OR cst_id IS NULL

-- CHECK for unwanted Spaces
-- Expectation: No result
SELECT 
	cst_firstname
FROM Silver.crm_cust_info
WHERE cst_firstname != TRIM(cst_firstname)

-- Data Standardization and Consistency
SELECT DISTINCT 
	cst_Material_Status 
FROM Silver.crm_cust_info

SELECT *
FROM Silver.crm_cust_info

-- Checking the complete data 
SELECT * 
FROM Silver.crm_cust_info

-- Counting all rows 
SELECT COUNT(*) 
FROM Silver.crm_cust_info

PRINT '=========================================================='
PRINT 'Checking Silver.crm_prd_info'
PRINT '=========================================================='
--Check for null or Duplicates in Primary key
--Expectation : NO result
SELECT 
prd_id,
COUNT(*)
FROM Silver.crm_prd_info
GROUP BY prd_id
HAVING COUNT(*) > 1 OR prd_id IS NULL

-- Check for unwanted spaces 
-- Expectation : No results
SELECT 
	prd_nm
FROM Silver.crm_prd_info
WHERE prd_nm != TRIM(prd_nm)

-- Check for NULL and Negative number
-- Expectation : No results
SELECT
	prd_cost
FROM Silver.crm_prd_info
WHERE prd_cost < 0 
	OR prd_cost IS NULL

-- Data Standardization and Consistency
SELECT DISTINCT 
	prd_line
FROM Silver.crm_prd_info

-- Check for Invalid Date Orders 
SELECT prd_key,prd_start_dt,prd_end_dt
FROM Silver.crm_prd_info
WHERE prd_end_dt < prd_start_dt

-- Checking the complete data 
SELECT * FROM Silver.crm_prd_info

-- Counting all rows 
SELECT COUNT(*) FROM Silver.crm_prd_info

PRINT '=========================================================='
PRINT 'Checking Silver.crm_sales_details'
PRINT '=========================================================='
-- CHECK FOR INVALID DATES
-- >> Expectation : No invalid dates 
SELECT 
NULLIF(sls_due_dt,0) AS sls_due_dt
FROM Silver.crm_sales_details
WHERE sls_due_dt = 0 
OR LEN(sls_due_dt) != 8
OR sls_due_dt > 25000101
OR sls_due_dt < 19000101

-- CHECK FOR INVALID DATE ORDERS 
select * 
from Silver.crm_sales_details
where sls_order_dt > sls_ship_dt 
	OR sls_order_dt > sls_due_dt

-- Check Data consistency : Sales = Quantity * price 
-- >> Values must not be NULL, zero, or negative.
-- >> Expectation : No result

SELECT DISTINCT 
	sls_quantity,
	sls_price,
	sls_sales
FROM Silver.crm_sales_details
WHERE sls_sales != sls_quantity * sls_price
   OR sls_sales IS NULL 
   OR sls_quantity IS NULL 
   OR sls_price IS NULL 
   OR sls_sales <= 0 
   OR sls_quantity <= 0 
   OR sls_price <= 0

-- Checking the complete data 
SELECT * FROM Silver.crm_sales_details

-- Counting all rows 
SELECT COUNT(*) FROM Silver.crm_sales_details

PRINT '=========================================================='
PRINT 'Checking Silver.erp_cust_az12'
PRINT '=========================================================='
-- Identify Out-of-Date range 
-- Expectation : Birthdates between 1924-01-01 and Today
SELECT DISTINCT 
	bdate 
FROM Silver.erp_cust_az12
WHERE bdate < '1924-01-01' 
	OR bdate > GETDATE()

-- Data Standardization and consistency
SELECT DISTINCT 
gen 
FROM Silver.erp_cust_az12

-- Checking the complete data 
SELECT * FROM Silver.erp_cust_az12

-- Counting all rows 
SELECT COUNT(*) FROM Silver.erp_cust_az12

PRINT '=========================================================='
PRINT 'Checking Silver.erp_loc_a101'
PRINT '=========================================================='
-- Data Standardization & Consistency
SELECT DISTINCT 
cntry
FROM Silver.erp_loc_a101
ORDER BY cntry

-- Checking the complete data 
SELECT * 
FROM Silver.erp_loc_a101

-- Counting all rows 
SELECT COUNT(*) 
FROM Silver.erp_loc_a101

PRINT '=========================================================='
PRINT 'Checking Silver.erp_px_cat_g1v2'
PRINT '=========================================================='
-- Check for spaces in cat and subcat and maintainance
	SELECT 
		cat 
	FROM Silver.erp_px_cat_g1v2
	WHERE cat != TRIM(cat) 
		OR subcat != TRIM(subcat) 
		OR maintenance != TRIM(maintenance)

-- Data standardization & Consistency 
	SELECT DISTINCT
		maintenance 
	FROM Silver.erp_px_cat_g1v2

-- Checking the complete data 
SELECT * FROM Silver.erp_px_cat_g1v2

-- Counting all rows 
SELECT COUNT(*) FROM Silver.erp_px_cat_g1v2
